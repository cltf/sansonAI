{{define "content"}}
<!-- 学习资料详情页 -->
<div class="learning-resource-detail-page">
    <!-- 资料头部信息 -->
    <div class="resource-header">
        <div class="resource-title-section">
            <h1 class="resource-title">{{.resource.Title}}</h1>
            <div class="resource-meta">
                <div class="resource-basic-info">
                    <div class="resource-type">
                        <i class="{{.resource.TypeIcon}}"></i>
                        <span>{{.resource.TypeName}}</span>
                    </div>
                    <div class="resource-size">
                        <i class="fas fa-hdd"></i>
                        <span>{{.resource.FileSize}}</span>
                    </div>
                    <div class="resource-format">
                        <i class="fas fa-file"></i>
                        <span>{{.resource.Format}}</span>
                    </div>
                    <div class="resource-upload-time">
                        <i class="fas fa-clock"></i>
                        <span>{{.resource.CreatedAt.Format "2006-01-02 15:04"}}</span>
                    </div>
                </div>
                
                <div class="uploader-info">
                    <img src="{{.resource.UploaderAvatar}}" alt="{{.resource.UploaderName}}" class="uploader-avatar">
                    <div class="uploader-details">
                        <div class="uploader-name">{{.resource.UploaderName}}</div>
                        <div class="uploader-level">Lv.{{.resource.UploaderLevel}}</div>
                    </div>
                </div>
                
                <div class="resource-stats">
                    <div class="resource-rating">
                        <div class="stars">
                            {{range $i := seq 5}}
                            <i class="fas fa-star {{if le $i .resource.Rating}}filled{{end}}"></i>
                            {{end}}
                        </div>
                        <span class="rating-text">{{.resource.Rating}}/5</span>
                        <span class="rating-count">({{.resource.RatingCount}}人评分)</span>
                    </div>
                    
                    <div class="resource-downloads">
                        <i class="fas fa-download"></i>
                        <span>{{.resource.DownloadCount}} 次下载</span>
                    </div>
                </div>
            </div>
            
            <!-- 标签 -->
            <div class="resource-tags">
                {{range .resource.TagsArray}}
                <span class="tag">{{.}}</span>
                {{end}}
            </div>
        </div>
    </div>

    <!-- 主要内容区域 -->
    <div class="resource-main-content">
        <!-- 左侧预览区 -->
        <main class="resource-preview-section">
            <div class="preview-container">
                {{if eq .resource.Type "ebook"}}
                <!-- 电子书预览 -->
                <div class="ebook-preview">
                    <div class="preview-header">
                        <h3>内容预览</h3>
                        <div class="preview-controls">
                            <button class="btn-preview-control" onclick="previousPage()">
                                <i class="fas fa-chevron-left"></i>
                            </button>
                            <span class="page-info">第 <span id="currentPage">1</span> 页，共 <span id="totalPages">50</span> 页</span>
                            <button class="btn-preview-control" onclick="nextPage()">
                                <i class="fas fa-chevron-right"></i>
                            </button>
                        </div>
                    </div>
                    <div class="preview-content" id="previewContent">
                        <div class="preview-page">
                            <h4>第一章 机器学习基础</h4>
                            <p>机器学习是人工智能的一个重要分支，它使计算机能够在没有明确编程的情况下学习和改进。</p>
                            <p>机器学习主要分为三大类：监督学习、无监督学习和强化学习。</p>
                        </div>
                    </div>
                </div>
                {{else if eq .resource.Type "video"}}
                <!-- 视频预览 -->
                <div class="video-preview">
                    <div class="video-player">
                        <video id="videoPlayer" controls preload="metadata">
                            <source src="{{.resource.PreviewURL}}" type="video/mp4">
                            您的浏览器不支持视频播放。
                        </video>
                    </div>
                    <div class="video-info">
                        <h3>{{.resource.Title}}</h3>
                        <div class="video-meta">
                            <span class="duration">时长：{{.resource.Duration}}</span>
                            <span class="quality">清晰度：{{.resource.Quality}}</span>
                        </div>
                    </div>
                </div>
                {{else if eq .resource.Type "dataset"}}
                <!-- 数据集预览 -->
                <div class="dataset-preview">
                    <div class="dataset-header">
                        <h3>数据集预览</h3>
                        <div class="dataset-info">
                            <span class="data-size">数据量：{{.resource.DataSize}}</span>
                            <span class="data-format">格式：{{.resource.DataFormat}}</span>
                        </div>
                    </div>
                    <div class="dataset-content">
                        <div class="data-sample">
                            <h4>数据样例</h4>
                            <div class="sample-table">
                                <table>
                                    <thead>
                                        <tr>
                                            <th>ID</th>
                                            <th>特征1</th>
                                            <th>特征2</th>
                                            <th>标签</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <tr>
                                            <td>1</td>
                                            <td>0.123</td>
                                            <td>0.456</td>
                                            <td>1</td>
                                        </tr>
                                        <tr>
                                            <td>2</td>
                                            <td>0.234</td>
                                            <td>0.567</td>
                                            <td>0</td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                {{else}}
                <!-- 其他类型预览 -->
                <div class="default-preview">
                    <div class="preview-placeholder">
                        <i class="{{.resource.TypeIcon}}"></i>
                        <h3>{{.resource.TypeName}}预览</h3>
                        <p>此类型资料暂不支持在线预览，请下载后查看完整内容。</p>
                    </div>
                </div>
                {{end}}
            </div>
        </main>
        
        <!-- 右侧详情区 -->
        <aside class="resource-detail-section">
            <!-- 资料详情 -->
            <div class="resource-details">
                <h3>资料详情</h3>
                <div class="detail-content">
                    <div class="detail-item">
                        <span class="detail-label">资料类型：</span>
                        <span class="detail-value">{{.resource.TypeName}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">难度级别：</span>
                        <span class="detail-value difficulty-{{.resource.Level}}">{{.resource.DifficultyText}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">所属分类：</span>
                        <span class="detail-value">{{.resource.CategoryName}}</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">文件大小：</span>
                        <span class="detail-value">{{.resource.FileSize}}</span>
                    </div>
                </div>
            </div>
            
            <!-- 详细简介 -->
            <div class="resource-description">
                <h3>详细简介</h3>
                <div class="description-content">
                    {{.resource.Description}}
                </div>
            </div>
            
            <!-- 下载区域 -->
            <div class="download-section">
                <div class="download-info">
                    <div class="points-required">
                        <i class="fas fa-coins"></i>
                        <span>需要积分：<strong>{{.resource.PointsRequired}}</strong></span>
                    </div>
                    <div class="user-points">
                        <span>您的积分：<strong>{{.user.Points}}</strong></span>
                    </div>
                </div>
                <button class="btn-download-resource" onclick="downloadResource('{{.resource.ID}}')" {{if lt .user.Points .resource.PointsRequired}}disabled{{end}}>
                    <i class="fas fa-download"></i>
                    <span>下载资料</span>
                </button>
            </div>
            
            <!-- 用户评论 -->
            <div class="comments-section">
                <div class="comments-header">
                    <h3>用户评论 ({{.resource.CommentCount}})</h3>
                    {{if .user}}
                    <button class="btn-add-comment" onclick="showCommentForm()">
                        <i class="fas fa-plus"></i> 添加评论
                    </button>
                    {{end}}
                </div>
                
                {{if .user}}
                <!-- 评论表单 -->
                <div class="comment-form" id="commentForm" style="display: none;">
                    <div class="rating-input">
                        <label>评分：</label>
                        <div class="stars-input">
                            {{range $i := seq 5}}
                            <i class="fas fa-star" data-rating="{{$i}}" onclick="setRating({{$i}})"></i>
                            {{end}}
                        </div>
                        <span class="rating-text">请选择评分</span>
                    </div>
                    <textarea id="commentContent" placeholder="写下您的评论..." rows="4"></textarea>
                    <div class="comment-actions">
                        <button class="btn-submit-comment" onclick="submitComment()">提交评论</button>
                        <button class="btn-cancel-comment" onclick="hideCommentForm()">取消</button>
                    </div>
                </div>
                {{end}}
                
                <!-- 评论列表 -->
                <div class="comments-list">
                    {{range .comments}}
                    <div class="comment-item">
                        <div class="comment-header">
                            <div class="commenter-info">
                                <img src="{{.UserAvatar}}" alt="{{.Username}}" class="commenter-avatar">
                                <div class="commenter-details">
                                    <div class="commenter-name">{{.Username}}</div>
                                    <div class="commenter-level">Lv.{{.UserLevel}}</div>
                                </div>
                            </div>
                            <div class="comment-meta">
                                <div class="comment-rating">
                                    <div class="stars">
                                        {{range $i := seq 5}}
                                        <i class="fas fa-star {{if le $i .Rating}}filled{{end}}"></i>
                                        {{end}}
                                    </div>
                                    <span class="rating-value">{{.Rating}}/5</span>
                                </div>
                                <div class="comment-time">{{.CreatedAt.Format "2006-01-02 15:04"}}</div>
                            </div>
                        </div>
                        <div class="comment-content">
                            {{.Content}}
                        </div>
                    </div>
                    {{end}}
                </div>
            </div>
        </aside>
    </div>
    
    <!-- 相关资料推荐 -->
    <section class="related-resources">
        <h3>相关资料推荐</h3>
        <div class="related-resources-grid">
            {{range .relatedResources}}
            <div class="related-resource-card">
                <div class="related-resource-cover">
                    <img src="{{.CoverImage}}" alt="{{.Title}}">
                    <div class="resource-type-badge">
                        <i class="{{.TypeIcon}}"></i>
                    </div>
                </div>
                <div class="related-resource-info">
                    <h4 class="related-resource-title">
                        <a href="/learning-resources/{{.ID}}">{{.Title}}</a>
                    </h4>
                    <div class="related-resource-meta">
                        <div class="related-resource-stats">
                            <span class="rating">
                                <i class="fas fa-star"></i>
                                {{.Rating}}
                            </span>
                            <span class="downloads">
                                <i class="fas fa-download"></i>
                                {{.DownloadCount}}
                            </span>
                        </div>
                        <div class="related-resource-level level-{{.Level}}">
                            {{.DifficultyText}}
                        </div>
                    </div>
                </div>
            </div>
            {{end}}
        </div>
    </section>
</div>

<script>
// 预览功能
let currentPage = 1;
let totalPages = 50;

function previousPage() {
    if (currentPage > 1) {
        currentPage--;
        updatePageDisplay();
    }
}

function nextPage() {
    if (currentPage < totalPages) {
        currentPage++;
        updatePageDisplay();
    }
}

function updatePageDisplay() {
    document.getElementById('currentPage').textContent = currentPage;
}

// 评分功能
let selectedRating = 0;

function setRating(rating) {
    selectedRating = rating;
    const stars = document.querySelectorAll('.stars-input i');
    stars.forEach((star, index) => {
        if (index < rating) {
            star.classList.add('filled');
        } else {
            star.classList.remove('filled');
        }
    });
    document.querySelector('.rating-text').textContent = `已选择 ${rating} 星`;
}

// 评论功能
function showCommentForm() {
    document.getElementById('commentForm').style.display = 'block';
}

function hideCommentForm() {
    document.getElementById('commentForm').style.display = 'none';
    selectedRating = 0;
    document.getElementById('commentContent').value = '';
    document.querySelectorAll('.stars-input i').forEach(star => star.classList.remove('filled'));
    document.querySelector('.rating-text').textContent = '请选择评分';
}

function submitComment() {
    const content = document.getElementById('commentContent').value.trim();
    
    if (selectedRating === 0) {
        alert('请选择评分');
        return;
    }
    
    if (!content) {
        alert('请输入评论内容');
        return;
    }
    
    alert('评论提交成功！');
    hideCommentForm();
}

// 下载功能
function downloadResource(resourceId) {
    if (confirm('确定要下载这个资料吗？')) {
        alert('开始下载资料...');
    }
}
</script>
{{end}} 